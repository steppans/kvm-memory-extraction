# 6. Модель угроз и практические выводы

---

## Содержание

6. [Модель угроз и практические выводы](#модель-угроз-и-практические-выводы)
   - [Используемая модель угроз и допущения](#используемая-модель-угроз-и-допущения)
   - [Демонстрация ключевых положений](#демонстрация-ключевых-положений)
     - [Ограниченные привилегий суперпользователя внутри VM](#ограниченные-привилегий-суперпользователя-внутри-vm)
     - [Защита LUKS ограничена диском](#защита-luks-ограничена-диском)
     - [Полный контроль гипервизора](#полный-контроль-гипервизора)
   - [Практические риски и ограничения безопасности](#практические-риски-и-ограничения-безопасности)
   - [Итог и рекомендации по безопасности виртуализованных сред](#итог-и-рекомендации-по-безопасности-виртуализованных-сред)
   

## Используемая модель угроз и допущения

В рамках данного исследования предполагается следующая модель угроз:

- Атакующий имеет доступ к **гипервизору** (основная ОС), на котором запущена виртуальная машина.  
- Атакующий может выполнять команды с правами **root** на гипервизоре, включая подключение QCOW2-дисков, работу с NBD и дампы процессов QEMU.  
- Атакующий **не имеет физического доступа** к хосту или гостевой машине.  
- Гостевая система (VM) настроена с использованием стандартного **LUKS-шифрования root-раздела** и механизма autoinstall через cloud-init.  

> **Допущение:** исследование ограничено безопасностью данных *в состоянии покоя* и *во время работы VM*. Не рассматриваются атаки через уязвимости приложений внутри гостя или через сеть.

## Демонстрация ключевых положений

### Ограниченные привилегий суперпользователя внутри VM

Пользователь гостевой ОС **может не иметь прав суперпользователя**, что позволяет ему производить действия в гостевой системе только в рамках разрешенных политик безопасности.  

Даже если пользователь имеет `root` в гостевой системе, его привилегии ограничены границами виртуальной машины. Он не может напрямую получить доступ к памяти гипервизора, другим VM или зашифрованным ключам, хранящимся на хосте. Любые попытки вмешательства вне гостевой ОС блокируются стандартными механизмами изоляции виртуализации (например, аппаратным разделением памяти через KVM).  

**Вывод:** ограничение привилегий внутри VM действительно существует, но оно снимается, если гипервизор скомпрометирован.


### Защита LUKS ограничена диском

- LUKS эффективно шифрует содержимое диска, обеспечивая безопасность *data at rest*.  
- Однако **мастер‑ключ хранится в RAM после монтирования** раздела, что делает его доступным для атак с гипервизора, например:

  - дамп памяти VM (`gcore`);
  - анализ содержимого оперативной памяти (`bulk_extractor`).

**Вывод:** LUKS защищает данные на диске, но не данные, находящиеся в активной памяти VM.


### Полный контроль гипервизора

- Гипервизор имеет доступ к **всей памяти и устройствам VM**, включая:

  - CPU state;
  - RAM;
  - виртуальные диски и их ключи;
  - I/O устройства.  

- Любые данные в гостевой системе могут быть извлечены или изменены гипервизором, независимо от того, что делает `root` внутри VM.

**Вывод:** гипервизор полностью контролирует состояние VM, что ставит под угрозу доверие к гостевой системе при компрометации хоста.


## Практические риски и ограничения безопасности

1. **Привилегии суперпользователя в VM ограничены, но уязвимы на уровне гипервизора.**  
   Любые атаки на гипервизор могут обойти внутренние механизмы безопасности VM.

2. **Шифрование диска не защищает от атак на работающую систему.**  
   Даже если root‑пароль неизвестен, мастер‑ключ можно извлечь из RAM.

3. **Полный контроль гипервизора позволяет атакующему мониторить и модифицировать VM.**  
   Даже зашифрованные тома можно расшифровать, используя извлечённые ключи.


## Итог и рекомендации по безопасности виртуализованных сред

Проведённая демонстрация показала ключевые аспекты безопасности при работе с зашифрованными виртуальными машинами:

- LUKS обеспечивает защиту данных **только на диске** виртуальной машины;
- данные, находящиеся в **оперативной памяти**, остаются уязвимыми для гипервизора;
- **компрометация гипервизора** полностью подрывает безопасность гостевой системы.

**Основная рекомендация:** доверяйте гипервизору и активно защищайте его. Без надёжного гипервизора любая внутренняя защита VM теряет смысл.  

Дополнительно для повышения безопасности можно рассматривать:

- аппаратное шифрование памяти и технологии защищённого исполнения (например, AMD SEV, Intel TDX);  
- изоляцию критических процессов и ключей от операционной системы хоста;  
- контроль и аудит действий гипервизора, чтобы уменьшить риски компрометации.

Эти механизмы не были подробно рассмотрены в настоящем исследовании, но представляют собой перспективные направления для будущих экспериментов и анализа угроз.  

**Вывод:** виртуализация обеспечивает удобство и гибкость, но накладывает ограничения на гарантии безопасности. Любая доверенная вычислительная база должна учитывать возможность компрометации гипервизора и предусматривать меры защиты на уровне основной ОС и аппаратуры.
