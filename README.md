# KVM Memory Extraction

В рамках данной работы исследуется модель угроз безопасности виртуализованных сред при использовании дискового шифрования LUKS. Основное внимание уделяется анализу границ доверия между гостевой операционной системой, гипервизором и хостовой ОС.

На практических примерах показано, что шифрование диска эффективно защищает данные в состоянии покоя, однако не распространяется на содержимое оперативной памяти после загрузки системы. Демонстрируются атаки, при которых гипервизор получает доступ к памяти работающей виртуальной машины, извлекает криптографические ключи и выполняет расшифровку полного диска.

Работа иллюстрирует, что компрометация основной ОС полностью подрывает модель безопасности гостевой системы.

Проект носит исследовательский характер и предназначен для демонстрации практических рисков, связанных с виртуализацией, а также для формирования корректного понимания доверенной вычислительной базы и её ограничений.


## План работ

### 1. Подготовка среды исследования

- Развёртывание гипервизора KVM/QEMU на отдельном узле;
- Создание виртуальной машины на базе ОС Ubuntu;
- Настройка полного шифрования диска с использованием LUKS.

**Цель:** освоить процесс развёртывания виртуальных машин в среде KVM/QEMU и настроить полное шифрование их дисков с помощью LUKS как основы для дальнейшего анализа безопасности.


### 2. Демонстрация безопасности данных при выключенной VM

- Попытка прочитать содержимое .qcow2 образа диска;
- Проверка, что данные выглядят как случайный набор байтов -> LUKS работает.

**Цель:** зафиксировать, что до загрузки виртуальной машины диск абсолютно защищён.


### 3. Атака №1 - доступ к оперативной памяти работающей VM

- Запуск виртуальной машины;
- Выполнение действий внутри виртуальной машины;
- Извлечение дампа RAM (оперативной памяти) на узле гипервизора;
- Анализ дампа RAM работающей виртуальной машины.

**Цель:** продемонстрировать возможность получения доступа к данным из оперативной памяти работающей виртуальной машины со стороны гипервизора, несмотря на использование шифрования диска LUKS и механизмов аутентификации внутри гостевой ОС.


### 4. Атака №2 - извлечение LUKS master key из оперативной памяти

- Поиск криптографических артефактов в дампе памяти с использованием bulk_extractor;
- Выделение предполагаемого LUKS master key;
- Проверка корректности извлечённого ключа с помощью cryptsetup.

**Цель:** исследовать возможность извлечения LUKS master key из оперативной памяти виртуальной машины со стороны гипервизора без знания пользовательского пароля.


### 5. Атака №3 - расшифровка полного диска виртуальной машины

- Монтирование расшифрованного логического тома и восстановление файловой структуры виртуальной машины;
- Получение доступа ко всем данным гостевой ОС в offline-режиме.

**Цель:** продемонстрировать возможность полного восстановления содержимого зашифрованного диска виртуальной машины гипервизором при наличии извлечённого LUKS master key, без необходимости запуска гостевой системы.


### 6. Модель угроз и практические выводы

- Описание используемой модели угроз и допущений исследования;

- Демонстрация следующих положений:
  - привилегии суперпользователя внутри виртуальной машины ограничены по сравнению с привилегиями суперпользователя на стороне гипервизора;
  - шифрование LUKS обеспечивает защиту данных на диске виртуальной машины, но не распространяется на содержимое оперативной памяти;
  - гипервизор обладает полным контролем над состоянием и данными гостевой операционной системы;

- Формулирование выводов о практических рисках и ограничениях безопасности при использовании виртуализации.


## Содержание

- [Исследовательское устройство](docs/research_platform.md)
- [Основные теоретические аспекты](docs/theoretical_setup.md)
- [1. Подготовка среды исследования](docs/01_environment_setup.md)
- [2. Демонстрация безопасности данных при выключенной VM](docs/02_security_demonstation.md)
- [3. Атака №1 - доступ к оперативной памяти VM](docs/03_ram_attack.md)
- [4. Атака №2 - извлечение LUKS master key из RAM](docs/04_luks_masterkey_attack.md)
- [5. Атака №3 - расшифровка полного диска VM offline](docs/05_full_disk_decryption.md)
- [6. Формирование отчёта и выводов](docs/06_threat_model_and_conclusions.md)

## СПИСОК ИСПОЛЬЗУЕМЫХ МАТЕРИАЛОВ

- **KVM** - <https://linux-kvm.org/page/Main_Page>
- **QEMU** - <https://www.qemu.org/docs/master/>
- **LUKS** - <https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup>
- **cloud-init documentation** - <https://cloudinit.readthedocs.io/en/latest/index.html>
- **cloud-init autoinstall** - <https://canonical-subiquity.readthedocs-hosted.com/en/latest/reference/autoinstall-reference.html>
- **bulk_extractor sources** - <https://github.com/simsong/bulk_extractor>
- **bulk_extractor manual** - <https://digitalcorpora.s3.amazonaws.com/downloads/bulk_extractor/BEUsersManual.pdf>
